# java异常处理

## 工作案例

今天在整改项目里的日志代码。

### 现状：

1. 只定义了一种业务异常NException，有errorCode和message两个字段。
2. 在business层捕获了NException，打日志，塞进去一个新的错误码，向外层再抛出NException。

### 整改的原因：

在定位问题的时候，发现日志里的信息不足。

### 最快的整改方式：

1. 依然在各层都捕获异常并打日志。（捕获NException，打日志，换个错误码，向外层再抛出NException）
2. 在日志中加上关键的信息，方便定位问题。

### 尝试的整改方式：

1. 在business层不打日志，抛出新的NException的时候把原NException放到异常链中，再向外抛出。
2. 在service层统一打日志。  
-- 由于公司日志工具类把异常链里的message做了乱码处理，导致日志非常难看。放弃这个方案。

## Effective java建议的异常处理方式

1. 只对异常的场景使用异常。不要利用异常来实现业务逻辑。
2. 可查异常用在可以恢复的场景，运行时异常用在程序错误。
3. 避免不必要的可查异常。会导致API难用。从调用者的角度来考虑这个异常他会怎么处理。
4. 善加利用标准异常。
5. 抛出适合抽象层次的异常。为避免高层API和底层实现耦合，将底层的异常转换为高层的异常。避免异常转换时丢失信息，调用initCause方法，构成异常链。
6. 在异常中包含导致异常的详细信息，比如入参和字段。
7. 抛出异常时尽量让对象保持原有状态。抛出异常后，对象的值还是原来的值。


## 其他异常处理原则

1. 具体明确
2. 提早抛出
3. 延迟捕获。自己不处理的异常不要捕获。
